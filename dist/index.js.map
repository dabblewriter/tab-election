{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["\nexport type OnLeadership = (relinquish: Unsubscribe) => any;\nexport type Unsubscribe = () => void;\nexport type OnReceive = (msg: any) => void;\nexport type OnState<T> = (state: T) => void;\n\ninterface Deferred {\n  resolve: (value: any) => void;\n  reject: (reason?: any) => void;\n  timeout: number;\n}\n\nconst DONT_RECEIVE = {};\n\n/**\n * A Tab is an interfaces to synchronize state and messages between tabs. It uses BroadcastChannel and the Lock API.\n * This is a simplified version of the original implementation.\n */\nexport class Tab<T = Record<string, any>> extends EventTarget {\n  relinquishLeadership = () => {};\n\n  #name: string;\n  #id: string;\n  #callDeferreds = new Map<number, Deferred>();\n  #queuedCalls = new Map<number, { id: string, name: string; rest: any[] }>();\n  #channel: BroadcastChannel;\n  #isLeader = false;\n  #isLeaderReady = false;\n  #state: T;\n  #callCount = 0;\n  #api: any;\n\n  constructor(name = 'default') {\n    super();\n    this.#name = name;\n    this.#id = createTabId();\n    this.#state = {} as T;\n    this.#createChannel();\n    this.hasLeader().then(hasLeader => {\n      if (hasLeader) this.#postMessage('onSendState', this.#id, DONT_RECEIVE);\n    });\n  }\n\n  get isLeader() {\n    return this.#isLeader;\n  }\n\n  async hasLeader() {\n    return navigator.locks.request(`tab-${this.#name}`, { ifAvailable: true }, async lock => lock === null);\n  }\n\n  getState() {\n    return this.#state;\n  }\n  setState(state: T) {\n    if (!this.isLeader) throw new Error('Only the leader can set state');\n    this.#onState(state);\n    this.#postMessage('onState', state, DONT_RECEIVE);\n  }\n\n  async waitForLeadership(onLeadership: OnLeadership): Promise<void> {\n    this.relinquishLeadership(); // Cancel any previous leadership requests\n\n    try {\n      return await navigator.locks.request(`tab-${this.#name}`, async lock => {\n        this.#isLeader = true;\n        this.#api = await onLeadership(this.relinquishLeadership);\n        this.#isLeaderReady = true;\n        this.#queuedCalls.forEach(({ id, name, rest }, callNumber) => this.#onCall(id, callNumber, name, ...rest));\n        this.#queuedCalls.clear();\n        this.dispatchEvent(new Event('leadershipchange'));\n        this.#postMessage('onLeader', this.#state, DONT_RECEIVE);\n        return new Promise<void>(resolve => this.relinquishLeadership = () => resolve()); // Never resolve\n      });\n    } finally {\n      this.#isLeader = false;\n      this.#api = null;\n      this.dispatchEvent(new Event('leadershipchange'));\n    }\n  }\n\n  call<R>(name: string, ...rest: any[]): Promise<R> {\n    const callNumber = ++this.#callCount;\n    return new Promise<R>(async (resolve, reject) => {\n      const timeout = setTimeout(() => {\n        this.#callDeferreds.delete(callNumber);\n        reject(new Error('Call timed out'));\n      }, 30_000);\n      this.#callDeferreds.set(callNumber, { resolve, reject, timeout });\n      if (this.isLeader && this.#isLeaderReady) {\n        this.#onCall(this.#id, callNumber, name, ...rest);\n      } else if (!this.isLeader && await this.hasLeader()) {\n        this.#postMessage('onCall', this.#id, callNumber, name, ...rest, DONT_RECEIVE);\n      } else {\n        this.#queuedCalls.set(callNumber, { id: this.#id, name, rest });\n      }\n    });\n  }\n\n  send(data: any): void {\n    this.#postMessage('onSend', data, DONT_RECEIVE);\n  }\n\n  close(): void {\n    this.relinquishLeadership();\n    this.#isLeader = false;\n    this.#channel.close();\n    this.#channel.onmessage = null;\n  }\n\n  #createChannel() {\n    this.#channel = new BroadcastChannel(`tab-${this.#name}`);\n    this.#channel.onmessage = e => this.#onMessage(e);\n  }\n\n  #postMessage(name: string, ...rest: any[]) {\n    const sendSelf = rest[rest.length - 1] !== DONT_RECEIVE;\n    if (!sendSelf) rest.pop();\n    const data = { name, rest };\n    try {\n      this.#channel.postMessage(data);\n      if (sendSelf) this.dispatchEvent(new MessageEvent('message', { data }));\n    } catch (e) {\n      // If the channel is closed, create a new one and try again\n      if (e.name === 'InvalidStateError') {\n        this.#createChannel();\n        this.#postMessage(name, ...rest);\n      }\n    }\n  }\n\n  #onMessage(event: MessageEvent) {\n    const { name, rest } = event.data as { name: string; rest: any[] };\n    if (name === 'onCall') this.#onCall.apply(this, rest);\n    else if (name === 'onReturn') this.#onReturn.apply(this, rest);\n    else if (name === 'onState') this.#onState.apply(this, rest);\n    else if (name === 'onSend') this.#onSend.apply(this, rest);\n    else if (name === 'onSendState') this.#onSendState.apply(this, rest);\n    else if (name === 'onLeader') this.#onLeader.apply(this, rest);\n    else console.error('Unknown message', name, rest);\n  }\n\n  async #onCall(id: string, callNumber: number, name: string, ...rest: any[]) {\n    if (!this.isLeader) return;\n    if (!this.#isLeaderReady) {\n      this.#queuedCalls.set(callNumber, { id, name, rest });\n      return;\n    }\n    try {\n      if (typeof this.#api?.[name] !== 'function') throw new Error(`Invalid API method \"${name}\"`);\n      const results = await this.#api[name](...rest);\n      this.#postMessage('onReturn', id, callNumber, null, results);\n    } catch (e) {\n      this.#postMessage('onReturn', id, callNumber, e);\n    }\n  }\n\n  #onReturn(forTab: string, callNumber: number, error: any, results: any) {\n    if (this.#id !== forTab) return;\n    const deferred = this.#callDeferreds.get(callNumber);\n    if (!deferred) return console.error('No deferred found for call', callNumber);\n    clearTimeout(deferred.timeout);\n    this.#callDeferreds.delete(callNumber);\n    if (error) deferred.reject(error);\n    else deferred.resolve(results);\n  }\n\n  #onState(data: T, id?: string) {\n    if (id && id !== this.#id) return;\n    this.#state = data;\n    this.dispatchEvent(new MessageEvent('state', { data }));\n  }\n\n  #onSend(data: any) {\n    this.dispatchEvent(new MessageEvent('message', { data }));\n  }\n\n  #onSendState(id: string) {\n    if (this.isLeader) {\n      this.#postMessage('onState', this.#state, id, DONT_RECEIVE);\n    }\n  }\n\n  #onLeader(state: T) {\n    this.#onState(state);\n    this.#queuedCalls.forEach(({ id, name, rest }, callNumber) =>\n      this.#postMessage('onCall', id, callNumber, name, ...rest)\n    );\n    this.#queuedCalls.clear();\n  }\n}\n\nconst chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');\n\nfunction createTabId() {\n  let id = '';\n  let length = 16;\n  while (length--) {\n    id += chars[(Math.random() * chars.length) | 0];\n  }\n  return id;\n}\n"]}